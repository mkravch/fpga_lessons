git clone https://github.com/Xilinx/device-tree-xlnx
cd device-tree-xlnx/
git checkout xilinx-v2019.1


в system-top 


.....

	memory {
		device_type = "memory";
		reg = <0x0 0x20000000>;
	};


    usb_phy0: phy0@e0002000 {
		compatible = "ulpi-phy";
		#phy-cells = <0>;
		reg = <0xe0002000 0x1000>;
		view-port = <0x0170>;
		drv-vbus;
	 };


	cpus {
	};
};


в pcw.dtsi


&usb0 {
 status = "okay";
 dr_mode = "host";
 usb-phy = <&usb_phy0>;
};


gcc -I my_dts -E -nostdinc -undef -D__DTS__ -x assembler-with-cpp -o system.dts system-top.dts
dtc -I dts -O dtb -o system.dtb system.dts
cp system.dtb ../../../smart-zynq.dtb & cp system.dtb ../../../devicetree.dtb & cp system.dts ../../../smart-zynq.dts


git clone https://github.com/Xilinx/u-boot-xlnx
cd u-boot-xlnx/
git checkout xilinx-v2025.2


make distclean
export CROSS_COMPILE=arm-linux-gnueabihf-
make xilinx_zynq_virt_defconfig
export DEVICE_TREE="smart-zynq"
cp ../smart-zynq.dts arch/arm/dts/ & cp ../smart-zynq.dtb arch/arm/dts/
make


Собираем kernel

git clone https://github.com/Xilinx/linux-xlnx
cd linux-xlnx/
export CROSS_COMPILE=arm-linux-gnueabihf-
make ARCH=arm xilinx_zynq_defconfig
make ARCH=arm UIMAGE_LOADADDR=0x8000 uImage
cp arch/arm/boot/uImage ../


Rootfs

https://rcn-ee.com/rootfs/eewiki/minfs/
в /etc/passwd в начале убираем x - root:x: -> root::


в u-boot


setenv bootcmd "fatload mmc 0 0x3000000 uImage; fatload mmc 0 0x2A00000 devicetree.dtb; bootm 0x3000000 - 0x2A00000"
setenv bootargs "mem=500M console=tty7 console=ttyPS0,115200n8 root=/dev/mmcblk0p2 rw rootfstype=ext4 fsck.repair=yes rootwait"
saveenv
reset



lsusb
lsblk
sudo mkdir /media/flash
sudo mount /dev/sda1 /media/flash
ls /media/flash
umount /dev/sda1